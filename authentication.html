<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Authentication ‚Äî Caleb‚Äôs Store</title>
        <script src="index.js"></script>

<style>
/* =====================================================
   ROOT VARIABLES
===================================================== */
:root {
  --bg-light: #e6ebf2;
  --bg-dark: #151720;

  --card-light: #eef2f8;
  --card-dark: #1f2230;

  --shadow-light: rgba(255,255,255,0.9);
  --shadow-dark: rgba(0,0,0,0.25);

  --primary: #5f27cd;
  --accent: #48dbfb;

  --success: #2ecc71;
  --error: #ff6b6b;

  --text-light: #2f3640;
  --text-dark: #f5f6fa;
}

/* =====================================================
   BASE
===================================================== */
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  height: 100vh;
  font-family: "Poppins", sans-serif;
  background: linear-gradient(135deg, #dde1e7, #f7f9fc);
  color: var(--text-light);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  transition: background 0.4s ease, color 0.4s ease;
}

body.dark {
  background: radial-gradient(circle at top, #1f2230, #0f1117);
  color: var(--text-dark);
}

/* =====================================================
   BACKGROUND BLUR
===================================================== */
.blurred-bg {
  position: fixed;
  inset: 0;
  backdrop-filter: blur(18px);
  background: linear-gradient(120deg, rgba(95,39,205,.15), rgba(72,219,251,.12));
  z-index: 0;
}

/* =====================================================
   AUTH CARD
===================================================== */
.auth-container {
  position: relative;
  z-index: 2;
  width: 360px;
  padding: 40px 32px;
  border-radius: 28px;
  background: var(--card-light);
  box-shadow:
    12px 12px 25px var(--shadow-dark),
    -12px -12px 25px var(--shadow-light);
  text-align: center;
  animation: slideUp .7s cubic-bezier(.22,1,.36,1);
}

body.dark .auth-container {
  background: var(--card-dark);
  box-shadow:
    12px 12px 30px rgba(0,0,0,0.6),
    -12px -12px 25px rgba(255,255,255,0.05);
}

/* =====================================================
   HEADINGS
===================================================== */
.auth-container h1 {
  font-weight: 700;
  letter-spacing: 1px;
  margin-bottom: 25px;
}

/* =====================================================
   INPUTS
===================================================== */
input {
  width: 100%;
  padding: 14px 16px;
  margin: 10px 0;
  border-radius: 14px;
  border: none;
  font-size: 14px;
  background: var(--bg-light);
  box-shadow:
    inset 6px 6px 12px var(--shadow-dark),
    inset -6px -6px 12px var(--shadow-light);
  transition: all .3s ease;
}

body.dark input {
  background: #141625;
  color: var(--text-dark);
  box-shadow:
    inset 6px 6px 12px rgba(0,0,0,0.6),
    inset -6px -6px 12px rgba(255,255,255,0.05);
}

input:focus {
  outline: none;
  transform: scale(1.03);
  box-shadow:
    inset 3px 3px 6px rgba(0,0,0,.25),
    inset -3px -3px 6px rgba(255,255,255,.7);
}

/* =====================================================
   PASSWORD TOGGLE
===================================================== */
.pass-toggle {
  position: absolute;
  right: 18px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  font-size: 16px;
  opacity: .7;
  transition: transform .2s ease;
}

.pass-toggle:hover {
  transform: translateY(-50%) scale(1.15);
}

/* =====================================================
   BUTTONS
===================================================== */
button {
  width: 100%;
  padding: 14px;
  margin-top: 18px;
  border-radius: 16px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  letter-spacing: .5px;
  background: linear-gradient(135deg, var(--primary), var(--accent));
  color: #fff;
  box-shadow:
    6px 6px 14px rgba(0,0,0,.25),
    -6px -6px 14px rgba(255,255,255,.25);
  transition: all .35s ease;
}

button:hover {
  transform: translateY(-2px) scale(1.03);
  box-shadow:
    10px 10px 25px rgba(0,0,0,.35);
}

button:active {
  transform: scale(.98);
}

/* =====================================================
   SOCIAL LOGIN
===================================================== */
.social-login {
  display: flex;
  gap: 10px;
  margin-top: 18px;
}

.social-login button {
  flex: 1;
  padding: 10px;
  font-size: 12px;
  background: transparent;
  color: inherit;
  box-shadow:
    5px 5px 12px rgba(0,0,0,.2),
    -5px -5px 12px rgba(255,255,255,.3);
}

/* =====================================================
   TOGGLES & LINKS
===================================================== */
.toggle {
  margin-top: 14px;
  font-size: 13px;
  cursor: pointer;
  opacity: .8;
  transition: opacity .3s;
}

.toggle:hover {
  opacity: 1;
  text-decoration: underline;
}

/* =====================================================
   DARK MODE SWITCH
===================================================== */
.dark-toggle {
  position: absolute;
  top: 20px;
  right: 22px;
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  opacity: .75;
}

.dark-toggle:hover {
  opacity: 1;
}

/* =====================================================
   CAPTCHA
===================================================== */
.captcha-box {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 12px;
  font-size: 13px;
}

/* =====================================================
   FEEDBACK
===================================================== */
.success {
  color: var(--success);
  margin-top: 12px;
  font-size: 14px;
  animation: pulse .4s ease;
}

.error {
  color: var(--error);
  margin-top: 12px;
  font-size: 14px;
  animation: shake .3s ease;
}

/* =====================================================
   PASSWORD STRENGTH
===================================================== */
#passwordStrength {
  font-size: 12px;
  margin-top: 4px;
  opacity: .8;
}

/* =====================================================
   ANIMATIONS
===================================================== */
@keyframes slideUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes shake {
  0%,100% { transform: translateX(0); }
  25% { transform: translateX(-4px); }
  75% { transform: translateX(4px); }
}

@keyframes pulse {
  from { transform: scale(.95); opacity: .6; }
  to { transform: scale(1); opacity: 1; }
}

/* =====================================================
   UTILITY
===================================================== */
.hidden {
  display: none;
}

/* =====================================================
   RESPONSIVE
===================================================== */
@media (max-width: 420px) {
  .auth-container {
    width: 90%;
    padding: 32px 24px;
  }
}
</style>
</head>
<body>
<!-- Security & Compliance Meta Hooks -->
<input type="hidden" id="csrfToken" value="">
<input type="hidden" id="sessionTimeout" value="900">
<input type="hidden" id="oauthProvider">
<input type="hidden" id="inviteCode">

<div class="blurred-bg"></div>

<!-- LOGIN -->
<div class="auth-container" id="loginForm" role="form" aria-labelledby="loginTitle">
  <button class="dark-toggle" id="themeToggle" aria-label="Toggle Dark Mode">üåô</button>

  <h1 id="loginTitle">Login</h1>

  <input type="text"
         id="loginUser"
         placeholder="Username / Email / Phone"
         autocomplete="username"
         autofocus
         required />

  <div style="position:relative;">
    <input type="password"
           id="loginPass"
           placeholder="Password"
           autocomplete="current-password"
           required />
    <span class="pass-toggle"
          onclick="togglePass('loginPass', this)"
          aria-label="Show or hide password">üëÅÔ∏è</span>
  </div>

  <!-- Remember Me -->
  <label>
    <input type="checkbox" id="rememberMe"> Remember Me
  </label>

  <!-- CAPTCHA -->
  <div class="captcha-box" id="captchaLogin">
    <input type="checkbox" id="captchaCheck"> I'm not a robot
  </div>

  <!-- 2FA Placeholder -->
  <input type="text"
         id="twoFactorCode"
         placeholder="2FA Code (if enabled)"
         inputmode="numeric"
         autocomplete="one-time-code" />

  <button onclick="login()" aria-busy="false">Sign In</button>

  <!-- Social Login -->
  <div class="social-login">
    <button data-provider="google">Login with Google</button>
    <button data-provider="facebook">Login with Facebook</button>
    <button data-provider="apple">Login with Apple</button>
  </div>

  <!-- Magic Link -->
  <div class="toggle" onclick="sendMagicLink()">Login via Magic Link</div>

  <div class="toggle" onclick="showForm('registerForm')">Create an account</div>
  <div class="toggle" onclick="showForm('forgotForm')">Forgot Password?</div>

  <!-- Alerts -->
  <div id="loginMsg" role="alert"></div>

  <!-- Legal -->
  <small>
    <a href="/privacy">Privacy Policy</a> ‚Ä¢
    <a href="/terms">Terms & Conditions</a>
  </small>
</div>

<!-- REGISTER -->
<div class="auth-container hidden" id="registerForm" role="form">
  <button class="dark-toggle" id="themeToggle2">üåô</button>

  <h1>Register</h1>

  <input type="text"
         id="regUser"
         placeholder="Username"
         data-check-availability="true"
         autocomplete="username"
         required />

  <input type="email"
         id="regEmail"
         placeholder="Email Address"
         autocomplete="email"
         required />

  <input type="tel"
         id="regPhone"
         placeholder="Phone Number"
         autocomplete="tel" />

  <input type="password"
         id="regPass"
         placeholder="Password"
         autocomplete="new-password"
         required />

  <!-- Password Strength -->
  <div id="passwordStrength"></div>

  <!-- Age Verification -->
  <label>
    <input type="checkbox" id="ageVerify" required>
    I confirm I am 18 years or older
  </label>

  <!-- Terms -->
  <label>
    <input type="checkbox" id="agreeTerms" required>
    I agree to the Terms & Privacy Policy
  </label>

  <!-- Newsletter -->
  <label>
    <input type="checkbox" id="newsletterOpt">
    Subscribe to newsletter
  </label>

  <!-- Invite Code -->
  <input type="text"
         id="inviteCodeInput"
         placeholder="Invite Code (optional)" />

  <button onclick="register()">Sign Up</button>

  <div class="toggle" onclick="showForm('loginForm')">Already have an account?</div>
  <div id="regMsg" role="alert"></div>
</div>

<!-- FORGOT PASSWORD -->
<div class="auth-container hidden" id="forgotForm" role="form">
  <button class="dark-toggle" id="themeToggle3">üåô</button>

  <h1>Forgot Password</h1>

  <input type="text"
         id="forgotUser"
         placeholder="Username / Email / Phone"
         autocomplete="username" />

  <button onclick="forgotPassword()">Send Reset PIN</button>

  <div class="toggle" onclick="showForm('resetForm')">Already have a PIN?</div>
  <div id="forgotMsg" role="alert"></div>
</div>

<!-- RESET PASSWORD -->
<div class="auth-container hidden" id="resetForm" role="form">
  <button class="dark-toggle" id="themeToggle4">üåô</button>

  <h1>Reset PIN</h1>

  <input type="text"
         id="resetUser"
         placeholder="Username"
         autocomplete="username" />

  <input type="text"
         id="resetPin"
         placeholder="Enter Reset PIN"
         inputmode="numeric"
         autocomplete="one-time-code" />

  <input type="password"
         id="newPass"
         placeholder="New Password"
         autocomplete="new-password" />

  <button onclick="resetPassword()">Reset Password</button>

  <div class="toggle" onclick="showForm('loginForm')">Back to Login</div>
  <div id="resetMsg" role="alert"></div>
</div>
<script>
/* =====================================================
   GLOBAL CONFIG
===================================================== */
const forms = ['loginForm', 'registerForm', 'forgotForm', 'resetForm'];
const themeToggles = document.querySelectorAll('.dark-toggle');
const SESSION_LIMIT = 3; // failed attempts
const SESSION_TIMEOUT = 15 * 60 * 1000; // 15 minutes

/* =====================================================
   FORM SWITCH
===================================================== */
function showForm(id) {
  forms.forEach(f => document.getElementById(f).classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

/* =====================================================
   PASSWORD TOGGLE
===================================================== */
function togglePass(id, el) {
  const input = document.getElementById(id);
  input.type = input.type === 'password' ? 'text' : 'password';
  el.textContent = input.type === 'password' ? 'üëÅÔ∏è' : 'üôà';
}

/* =====================================================
   DARK MODE
===================================================== */
themeToggles.forEach(btn => {
  btn.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
  });
});
if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');

/* =====================================================
   PASSWORD STRENGTH
===================================================== */
const passInput = document.getElementById('regPass');
if (passInput) {
  passInput.addEventListener('input', () => {
    const val = passInput.value;
    let strength = 'Weak';
    if (val.length >= 8 && /[A-Z]/.test(val) && /\d/.test(val)) strength = 'Strong';
    else if (val.length >= 6) strength = 'Medium';
    document.getElementById('passwordStrength').textContent = `Strength: ${strength}`;
  });
}

/* =====================================================
   REGISTER
===================================================== */
function register() {
  const user = regUser.value.trim();
  const pass = regPass.value.trim();
  const email = regEmail.value.trim();
  const phone = regPhone.value.trim();
  const msg = regMsg;

  if (!user || !pass || !email) {
    msg.innerHTML = '<p class="error">All required fields must be filled</p>';
    return;
  }

  if (!agreeTerms.checked || !ageVerify.checked) {
    msg.innerHTML = '<p class="error">You must agree to terms and confirm age</p>';
    return;
  }

  if (localStorage.getItem('user_' + user)) {
    msg.innerHTML = '<p class="error">Username already exists</p>';
    return;
  }

  const userData = {
    password: pass,
    email,
    phone,
    newsletter: newsletterOpt.checked,
    devices: [],
    logins: [],
    failed: 0,
    locked: false
  };

  localStorage.setItem('user_' + user, JSON.stringify(userData));
  msg.innerHTML = '<p class="success">Registration successful</p>';
  setTimeout(() => showForm('loginForm'), 1500);
}

/* =====================================================
   LOGIN
===================================================== */
function login() {
  const user = loginUser.value.trim();
  const pass = loginPass.value.trim();
  const msg = loginMsg;
  const remember = rememberMe.checked;
  const captcha = document.getElementById('captchaCheck');

  if (captcha && !captcha.checked) {
    msg.innerHTML = '<p class="error">Please verify CAPTCHA</p>';
    return;
  }

  let userData = JSON.parse(localStorage.getItem('user_' + user) || '{}');
  if (!userData.password) {
    msg.innerHTML = '<p class="error">User not found</p>';
    return;
  }

  if (userData.locked) {
    msg.innerHTML = '<p class="error">Account locked due to failed attempts</p>';
    return;
  }

  if (userData.password !== pass) {
    userData.failed++;
    if (userData.failed >= SESSION_LIMIT) userData.locked = true;
    localStorage.setItem('user_' + user, JSON.stringify(userData));
    msg.innerHTML = '<p class="error">Invalid credentials</p>';
    return;
  }

  // Successful login
  userData.failed = 0;
  const loginInfo = {
    time: new Date().toLocaleString(),
    device: navigator.userAgent
  };
  userData.logins.push(loginInfo);
  localStorage.setItem('user_' + user, JSON.stringify(userData));

  sessionStorage.setItem('activeUser', user);
  sessionStorage.setItem('lastActivity', Date.now());

  if (remember) localStorage.setItem('rememberUser', user);

  msg.innerHTML = '<p class="success">Login successful</p>';
  setTimeout(() => window.location.href = 'index.html', 1200);
}

/* =====================================================
   MAGIC LINK (DEMO)
===================================================== */
function sendMagicLink() {
  alert('Magic login link sent to your email (demo)');
}

/* =====================================================
   FORGOT PASSWORD
===================================================== */
function forgotPassword() {
  const user = forgotUser.value.trim();
  const msg = forgotMsg;
  if (!localStorage.getItem('user_' + user)) {
    msg.innerHTML = '<p class="error">User not found</p>';
    return;
  }
  const pin = Math.floor(1000 + Math.random() * 9000);
  localStorage.setItem('reset_' + user, pin);
  msg.innerHTML = `<p class="success">Reset PIN (demo): <b>${pin}</b></p>`;
}

/* =====================================================
   RESET PASSWORD
===================================================== */
function resetPassword() {
  const user = resetUser.value.trim();
  const pin = resetPin.value.trim();
  const newPass = newPass.value.trim();
  const msg = resetMsg;
  const savedPin = localStorage.getItem('reset_' + user);

  if (pin === savedPin && newPass) {
    let data = JSON.parse(localStorage.getItem('user_' + user));
    data.password = newPass;
    localStorage.setItem('user_' + user, JSON.stringify(data));
    localStorage.removeItem('reset_' + user);
    msg.innerHTML = '<p class="success">Password reset successful</p>';
    setTimeout(() => showForm('loginForm'), 1500);
  } else {
    msg.innerHTML = '<p class="error">Invalid PIN</p>';
  }
}

/* =====================================================
   SESSION TIMEOUT
===================================================== */
setInterval(() => {
  const last = sessionStorage.getItem('lastActivity');
  if (last && Date.now() - last > SESSION_TIMEOUT) {
    logout();
  }
}, 60000);

document.addEventListener('mousemove', () => sessionStorage.setItem('lastActivity', Date.now()));

/* =====================================================
   LOGOUT
===================================================== */
function logout() {
  sessionStorage.removeItem('activeUser');
  window.location.href = 'authentication.html';
}

/* =====================================================
   AUTO LOGIN (REMEMBER ME)
===================================================== */
const remembered = localStorage.getItem('rememberUser');
if (!sessionStorage.getItem('activeUser') && remembered) {
  loginUser.value = remembered;
}

/* =====================================================
   REDIRECT IF LOGGED IN
===================================================== */
if (sessionStorage.getItem('activeUser')) {
  window.location.href = 'index.html';
}
</script>
</body>
</html>
